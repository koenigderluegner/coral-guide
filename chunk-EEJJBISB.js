import{a as j}from"./chunk-MG3YOV2C.js";import{b as x}from"./chunk-EAHNU44C.js";import{i as m}from"./chunk-I7ZNO67X.js";import{a as C,b as d}from"./chunk-2SASL4UW.js";import{Z as T,ca as D,f as y}from"./chunk-ELCUH6OG.js";import{f as a,g as E,h as p,i as u}from"./chunk-IGH4DTA6.js";var g,L=(()=>{var _,f,c,l,o,I,S,v,R;let h=class h{constructor(){E(this,o);E(this,_);E(this,f);E(this,c);E(this,l);this.clearTimeout=3e3,this.userDataService=D(j),this.localStorage=D(C),p(this,_,D(d)),p(this,f,new y),p(this,c,new x(!0,[])),p(this,l,a(this,_).getSettings().useBeta?"_beta":"_live"),this.read(),a(this,c).compareWith=(t,e)=>t.category===e.category&&m(t.item)===m(e.item)}get currentToDoAmount(){return this.getCurrentToDo().length}get currentIsEmpty(){return this.currentToDoAmount===0}add(t){this.getCurrentToDo().push(t),this.save()}getCurrentToDo(){return this.userDataService.currentData().todos}save(){this.userDataService.save()}read(){let t=this.localStorage.getItem(g._LEGACY_TO_DO_STORE_KEY+a(this,l));t&&u(this,o,R).call(this,JSON.parse(t))}updateStatus(t,e,s,i=!1){let n={category:t,item:e};s?a(this,c).select(n):a(this,c).deselect(n),i?u(this,o,v).call(this):u(this,o,I).call(this)}resetLiveToDo(){this.localStorage.setItem(g._LEGACY_TO_DO_STORE_KEY+"_live",JSON.stringify([u(this,o,S).call(this)])),this.read()}resetBetaToDo(){this.localStorage.setItem(g._LEGACY_TO_DO_STORE_KEY+"_beta",JSON.stringify([u(this,o,S).call(this)])),this.read()}alreadyInList(t,e){let s=this.getCategoryList(t);if(s.length===0)return!1;let i=m(e);return!!s.find(n=>m(n.itemEntry)===i)}getCategoryList(t){return this.getCurrentToDo().filter(s=>s.context===t||t==="uncategorized"&&!s.context)}categoryCompleted$(){return a(this,f).asObservable()}completeCategory(t){a(this,f).next(t)}};_=new WeakMap,f=new WeakMap,c=new WeakMap,l=new WeakMap,o=new WeakSet,I=function(){clearTimeout(this.clearTimer),this.clearTimer=setTimeout(()=>{u(this,o,v).call(this)},this.clearTimeout)},S=function(){return{version:g._CURRENT_TO_DO_VERSION,offerings:[],cookingRecipes:[],journal:{critter:[],fish:[],gems:[],artifacts:[],fossils:[],insects:[]},uncategorized:[]}},v=function(){let t=a(this,c).selected;a(this,c).clear();let e=-1;t.forEach(s=>{let i=m(s.item);e=this.getCurrentToDo().findIndex(n=>m(n.itemEntry)===i&&n.context===s.category||s.category==="uncategorized"&&!n.context),e>=0&&this.getCurrentToDo().splice(e,1)}),this.save()},R=function(t){return t.length?("version"in t[0]&&(t.forEach((e,s)=>{let i=[];e.cookingRecipes.forEach(r=>i.push({context:"cooking_recipes",itemEntry:r.item})),e.offerings.forEach(r=>i.push({context:"offerings",itemEntry:r.item,amount:r.amount,quality:r.quality})),e.uncategorized.forEach(r=>i.push({itemEntry:r})),e.journal.artifacts.forEach(r=>i.push({context:"journal_artifacts",itemEntry:r})),e.journal.gems.forEach(r=>i.push({context:"journal_gems",itemEntry:r})),e.journal.fossils.forEach(r=>i.push({context:"journal_fossils",itemEntry:r})),e.journal.critter.forEach(r=>i.push({context:"journal_critter",itemEntry:r.item})),e.journal.fish.forEach(r=>i.push({context:"journal_fish",itemEntry:r.item})),e.journal.insects.forEach(r=>i.push({context:"journal_insects",itemEntry:r.item}));let n=this.userDataService.userData().data[s];n&&(n.todos=i)}),this.localStorage.removeItem(g._LEGACY_TO_DO_STORE_KEY+a(this,l)),this.userDataService.save()),t):[]},h._CURRENT_TO_DO_VERSION=1,h._LEGACY_TO_DO_STORE_KEY="checklist",h.\u0275fac=function(e){return new(e||h)},h.\u0275prov=T({token:h,factory:h.\u0275fac,providedIn:"root"});let O=h;return O})();g=L;export{L as a};
