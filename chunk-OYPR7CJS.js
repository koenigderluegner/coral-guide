import{a as N,b as p}from"./chunk-G2FIETR4.js";import{Rc as l,Sc as I,Tc as D,Uc as g,Z as R,ca as m,sa as A}from"./chunk-FPTGDBQG.js";import{d as c,e as h,f as d,g as S}from"./chunk-2QKSPLSF.js";var r,v=(()=>{var n,o,_,u,T,x;let s=class s{constructor(){h(this,u);h(this,n);h(this,o);h(this,_);this.userData=A({version:r._CURRENT_USER_DATA_VERSION,currentIndex:-1,data:[]}),this.currentIndex=g(()=>this.userData().currentIndex),d(this,n,m(N)),d(this,o,m(p).getSettings().useBeta?"_beta":"_live"),d(this,_,I(()=>this.userData().data[this.currentIndex()])),D(()=>{let e=this.currentIndex();l(()=>{this.userData().currentIndex=e,this.save()})})}get currentData(){return c(this,_)}save(){c(this,n).setItem(r._USER_DATA_STORE_KEY+c(this,o),JSON.stringify(this.userData()))}read(){let e=c(this,n).getItem(r._USER_DATA_STORE_KEY+c(this,o));if(e){let t=JSON.parse(e),a=S(this,u,T).call(this,t);this.userData.set(a),t.version!==a.version&&this.save()}else this.userData.set({version:r._CURRENT_USER_DATA_VERSION,currentIndex:0,data:[this.createEmptyUserData()]}),this.save()}delete(e){let t=e??this.currentIndex();this.currentIndex.update(a=>Math.max(0,a-1)),setTimeout(()=>{this.userData().data.splice(t,1),this.save()},0)}createEmptyUserData(e){return{name:e??S(this,u,x).call(this),myGuideFilter:{year:1,day:1,season:"Spring",weather:"Sunny",hideCompleted:!0},todoText:"",todos:[],checklists:{}}}};n=new WeakMap,o=new WeakMap,_=new WeakMap,u=new WeakSet,T=function(e){let t=e.data??[],a=e.version;for(;a!==r._CURRENT_USER_DATA_VERSION;)a?a===1?(t=t.map((i,f)=>(i.myGuideFilter={year:1,day:1,season:"Spring",weather:"Sunny",hideCompleted:!0},i.name=r._SAVE_GAME_NAME_PREFIX+(f+1),i.checklists={},i)),a=2):a===2&&(t=t.map(i=>(i.todoText="",i)),a=3):(t=[this.createEmptyUserData()],a=r._CURRENT_USER_DATA_VERSION);return{version:r._CURRENT_USER_DATA_VERSION,currentIndex:e.currentIndex??0,data:t}},x=function(){let e=new Set(this.userData().data.map(a=>a.name)),t=this.userData().data.length+1;for(;e.has(r._SAVE_GAME_NAME_PREFIX+t);)t++;return r._SAVE_GAME_NAME_PREFIX+t},s._CURRENT_USER_DATA_VERSION=3,s._USER_DATA_STORE_KEY="user-data",s._SAVE_GAME_NAME_PREFIX="Save game ",s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=R({token:s,factory:s.\u0275fac,providedIn:"root"});let E=s;return E})();r=v;export{v as a};
